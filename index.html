<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>pouch</title>
    <meta name="description" content="pouch description">

    <!-- See https://goo.gl/OOhYW5 -->
    <link rel="manifest" href="/manifest.json">

    <script src="/bower_components/pouchdb/dist/pouchdb.min.js"></script>
    <script src="/bower_components/pouchdb/dist/pouchdb.find.min.js"></script>
    <script src="/bower_components/webcomponentsjs/webcomponents-loader.js"></script>

    <link rel="import" href="/src/pouch-app/pouch-app.html">

  </head>
  <body>
    <pouch-app></pouch-app>

    <script>
//      PouchDB.debug.enable('*');

      var universe = ['bhp','cba'];

      function processTicker(ticker) {
        var localDB = new PouchDB('local_' + ticker);
        var remoteDB = new PouchDB('https://toobstar.cloudant.com/stock_' + ticker);

//      db.info().then(function (info) {
//        console.log(info);
//      })

        localDB.replicate.from(remoteDB, {live: false}).on('change', function (change) {
//      remoteDB.replicate.to(localDB, {live: true}).on('change', function (change) {
          console.log("change", change);
        }).on('error', function (err) {
          console.log("err-replicate", err);
        });
      }

      universe.forEach(processTicker);




//      function find(i) {
//        localDB.find({
//          selector: {
//            date: {$gte: null}
//          },
//          sort: ['date']
//        }).then(function (result) {
//          console.log("FIND_"+i, result);
//        }).catch(function (err) {
//          console.log(err);
//        });

//        localDB.find({
//          fields: ['_id', 'close'],
//          sort: ['date']
//        }).then(function (result) {
//          console.log("FIND_"+i, result);
//        }).catch(function (err) {
//          console.log(err);
//        });
//      }

//      find(1);
//      find(2);
//
//      localDB.createIndex({
//        index: {fields: ['date']}
//      });
//
//      find(3);


    </script>


  </body>
</html>
